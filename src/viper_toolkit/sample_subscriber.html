
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>3.5. Sample Subscriber Nodes &#8212; Viper Vision Inference Processing Endogenous (Edge) Robot</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet">
  <link href="../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script kind="utterances">

    var commentsRunWhenDOMLoaded = cb => {
    if (document.readyState != 'loading') {
        cb()
    } else if (document.addEventListener) {
        document.addEventListener('DOMContentLoaded', cb)
    } else {
        document.attachEvent('onreadystatechange', function() {
        if (document.readyState == 'complete') cb()
        })
    }
}

var addUtterances = () => {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src = "https://utteranc.es/client.js";
    script.async = "async";

    script.setAttribute("repo", "https://github.com/AndrewDamico/viper");
    script.setAttribute("issue-term", "pathname");
    script.setAttribute("theme", "github-light");
    script.setAttribute("label", "üí¨ comment");
    script.setAttribute("crossorigin", "anonymous");

    sections = document.querySelectorAll("div.section");
    if (sections !== null) {
        section = sections[sections.length-1];
        section.appendChild(script);
    }
}
commentsRunWhenDOMLoaded(addUtterances);
</script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="3.6. Robot OS (ROS)" href="../../docs/ros_structure.html" />
    <link rel="prev" title="3.4. Sample Publisher Nodes" href="sample_publisher.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Viper Vision Inference Processing Endogenous (Edge) Robot</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../intro.html">
   Welcome to your Jupyter Book
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Introduction
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../readme.html">
   1. The ROS VIPER Library
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../markdown.html">
   2. Markdown Files
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../../notebooks.html">
   3. Content with notebooks
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="sample_publisher.html">
     3.4. Sample Publisher Nodes
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     3.5. Sample Subscriber Nodes
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../docs/ros_structure.html">
     3.6. Robot OS (ROS)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../docs/Hardware.html">
     3.7. Hardware Configuration
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference external" href="https://www.linux.com">
     Linux Website
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Hardware
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference external" href="https://www.raspberrypi.com/">
   Raspberry Pi
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Software
 </span>
</p>
<ul class="nav bd-sidenav">
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Packages
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="readme.html">
   4. Viper Toolkit
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="viper_toolkit_python_modules.html">
     4.1. NameManager
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../augmented_vr_module/readme.html">
   5. Augmented VR Module
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../image_server/readme.html">
   6. Image Server
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../inland_ir_cam/readme.html">
   7. Inland IR Camera
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../model_server/readme.html">
   8. Model Server
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="simple">
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../pose_detection_module/readme.html">
   9. Pose Detection Module
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="simple">
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../scene_segmentation_module/readme.html">
   10. Scene Segmentation Module
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="simple">
  </ul>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/src/viper_toolkit/sample_subscriber.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/AndrewDamico/viper"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/AndrewDamico/viper/issues/new?title=Issue%20on%20page%20%2Fsrc/viper_toolkit/sample_subscriber.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/AndrewDamico/viper/edit/main/https://andrewdamico.github.io/viper/src/viper_toolkit/sample_subscriber.ipynb"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/AndrewDamico/viper/main?urlpath=tree/https://andrewdamico.github.io/viper/src/viper_toolkit/sample_subscriber.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-example-subscriber-node-and-class-definition">
   3.5.1. The Example Subscriber Node and Class Definition
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#detailed-look-at-class-attributes-properties-and-methods">
   3.5.2. Detailed Look at Class Attributes, Properties, and Methods
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#initialize-the-class-object">
     3.5.2.1. Initialize the Class Object
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#setup-ros">
     3.5.2.2. Setup ROS
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#setting-up-the-publisher">
     3.5.2.3. Setting up the Publisher
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-callback-function">
     3.5.2.4. The Callback Function
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-action-loop">
     3.5.2.5. The Action Loop
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#main-loop">
     3.5.2.6. Main Loop
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#final-output">
   3.5.3. Final Output
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="sample-subscriber-nodes">
<h1><span class="section-number">3.5. </span>Sample Subscriber Nodes<a class="headerlink" href="#sample-subscriber-nodes" title="Permalink to this headline">¬∂</a></h1>
<p>The subscriber node is very similar to the Publisher node, and many of my nodes are both publishers and subscribers.</p>
<p>The key difference is that the publisher and subscriber functions have a one to many relationship: there can be multiple subscribers subscribed to a topic, but there can only be one publisher.</p>
<p>A subscriber node receives the messages published by the subscriber nodes, up to the number of messages allowed in its queue.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">rospy</span>
<span class="kn">from</span> <span class="nn">std_msgs.msg</span> <span class="k">import</span> <span class="n">String</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="the-example-subscriber-node-and-class-definition">
<h2><span class="section-number">3.5.1. </span>The Example Subscriber Node and Class Definition<a class="headerlink" href="#the-example-subscriber-node-and-class-definition" title="Permalink to this headline">¬∂</a></h2>
<p>In each package, located in the ‚Äúviper/src‚Äù director of my git repository, there is a ‚Äòscript‚Äô folder. Within this folder are the various nodes for that package (which usually are also a class definition of that node). We can take a look at the sample subscriber node I built within the ‚Äúviper_toolkit‚Äù package.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">script</span> <span class="k">import</span> <span class="n">subscriber</span>
<span class="n">subscriber_source</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getsource</span><span class="p">(</span><span class="n">subscriber</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">subscriber_source</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>#!/usr/bin/env python3

import rospy
from std_msgs.msg import String

class SubscriberNode(object):
    
    def __init__(self):
        self.setup_ros()
        self.setup_subscriber()
        self.main_loop()
    
    def setup_ros(self):
        rospy.init_node(&#39;sample_subscriber&#39;)
        self.message = String()
        
    def setup_subscriber(self):
        rospy.Subscriber(
            name = &#39;topic&#39;, 
            data_class = String, 
            callback = self.callback,
            queue_size = 1)
        
    def callback(self, msg):
        self.message = msg
        self.action_loop()
        
    def action_loop(self):
        text = self.message.data
        rospy.loginfo(f&#39;I heard {text}&#39;)
        
    def main_loop(self):
        rospy.spin()

if __name__ == &#39;__main__&#39;:
    SubscriberNode()
</pre></div>
</div>
</div>
</div>
<p>Each of my class definitions will look similar, although will greatly vary in complexity.</p>
<p>Lets take a look at the different parts of this node.</p>
</div>
<div class="section" id="detailed-look-at-class-attributes-properties-and-methods">
<h2><span class="section-number">3.5.2. </span>Detailed Look at Class Attributes, Properties, and Methods<a class="headerlink" href="#detailed-look-at-class-attributes-properties-and-methods" title="Permalink to this headline">¬∂</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">script.subscriber</span> <span class="k">import</span> <span class="n">SubscriberNode</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">instance</span> <span class="o">=</span> <span class="n">SubscriberNode</span>
<span class="n">instance</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="n">String</span><span class="p">(</span><span class="s2">&quot;The time is now 1638136508.7424648&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">dissect</span><span class="p">(</span><span class="n">method</span><span class="p">):</span>
    <span class="n">class_</span> <span class="o">=</span> <span class="s1">&#39;SubscriberNode&#39;</span>
    <span class="n">instance_</span> <span class="o">=</span> <span class="s1">&#39;instance&#39;</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">f</span><span class="s1">&#39;</span><span class="si">{instance_}</span><span class="s1">.</span><span class="si">{method}</span><span class="s1">&#39;</span>
    <span class="c1">#i = f&#39;instance.{method}&#39;</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;class </span><span class="si">{class_}</span><span class="s1">(object):&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">e</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">getsource</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">dissect</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">class_</span><span class="o">=</span><span class="n">SubscriberNode</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Dissect() takes a method and a class, and returns the contents of the function.</span>
<span class="sd">    </span>
<span class="sd">    Keyword Arguments:</span>
<span class="sd">    </span>
<span class="sd">    method -- the name of the method being invoked</span>
<span class="sd">    class_ -- the name of the class object dissected</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">instance_</span> <span class="o">=</span> <span class="n">class_</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">f</span><span class="s1">&#39;instance_.</span><span class="si">{method}</span><span class="s1">&#39;</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;class </span><span class="si">{SubscriberNode.__name__}</span><span class="s1">(object):&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">e</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">getsource</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dissect</span><span class="p">(</span><span class="s1">&#39;__init__&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>class SubscriberNode(object):

    def __init__(self):
        self.setup_ros()
        self.setup_subscriber()
        self.main_loop()
</pre></div>
</div>
</div>
</div>
<div class="section" id="initialize-the-class-object">
<h3><span class="section-number">3.5.2.1. </span>Initialize the Class Object<a class="headerlink" href="#initialize-the-class-object" title="Permalink to this headline">¬∂</a></h3>
<p>The <strong>init</strong> class function executes at the time that the class in instantiated. We are telling the interpreter to first run the setup_ros() function, then run the setup_publisher() function, and finally to execute the main_loop() function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dissect</span><span class="p">(</span><span class="s1">&#39;__init__&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>class SubscriberNode(object):

    def __init__(self):
        self.setup_ros()
        self.setup_subscriber()
        self.main_loop()
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="setup-ros">
<h3><span class="section-number">3.5.2.2. </span>Setup ROS<a class="headerlink" href="#setup-ros" title="Permalink to this headline">¬∂</a></h3>
<p>We need to tell ROS that we would like to bring this node online; we are registering this kernel as ‚Äúsample_subscriber‚Äù.</p>
<p>During this step we will also set the class ‚Äúmessage‚Äù attribute using the class String.This allows us to retrieve the previous message upon failure so that we do not disrupt the system loop in the event of a dropped message. Note that the message types between the subscribers and the publishers must be the same.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dissect</span><span class="p">(</span><span class="s1">&#39;setup_ros&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>class SubscriberNode(object):

    def setup_ros(self):
        rospy.init_node(&#39;sample_subscriber&#39;)
        self.message = String()
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="setting-up-the-publisher">
<h3><span class="section-number">3.5.2.3. </span>Setting up the Publisher<a class="headerlink" href="#setting-up-the-publisher" title="Permalink to this headline">¬∂</a></h3>
<p>Next we will setup the subscriber API which allows a node to subscribe to a ‚ÄúTopic.‚Äù This node will be receive all messages of the topic ‚Äútopic‚Äù, but will only hold on to the last message (queue_size=1).</p>
<p>When it receives a new message it will execute its class callback() function</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dissect</span><span class="p">(</span><span class="s1">&#39;setup_subscriber&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>class SubscriberNode(object):

    def setup_subscriber(self):
        rospy.Subscriber(
            name = &#39;topic&#39;, 
            data_class = String, 
            callback = self.callback,
            queue_size = 1)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="the-callback-function">
<h3><span class="section-number">3.5.2.4. </span>The Callback Function<a class="headerlink" href="#the-callback-function" title="Permalink to this headline">¬∂</a></h3>
<p>The callback() function tells the node what to do once it receives a message. In this example we are asking the node to save the incoming message to the container we set up earlier. Rather than perform an action in the main loop, which is activated cyclically, we will have our action originate from this callback.</p>
<p>Thoughout my modules I use a variety of types of messages and callbacks to not only pass on data such as images and inference results, but to also publish ‚Äúflags‚Äù or indicators that a node wants something.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dissect</span><span class="p">(</span><span class="s1">&#39;callback&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>class SubscriberNode(object):

    def callback(self, msg):
        self.message = msg
        self.action_loop()
</pre></div>
</div>
</div>
</div>
<p>We can take a look at the message received:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Sample Message Received&quot;</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Sample Message Received
data: &quot;The time is now 1638136508.7424648&quot;
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="the-action-loop">
<h3><span class="section-number">3.5.2.5. </span>The Action Loop<a class="headerlink" href="#the-action-loop" title="Permalink to this headline">¬∂</a></h3>
<p>In our example action loop we will take the most recent message and transform its case into capital letters. We access the data in the message through it message.data class property. We then output the results to the terminal, as well as return the results when this function is called.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dissect</span><span class="p">(</span><span class="s1">&#39;action_loop&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>class SubscriberNode(object):

    def action_loop(self):
        text = self.message.data
        rospy.loginfo(f&#39;I heard {text}&#39;)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="main-loop">
<h3><span class="section-number">3.5.2.6. </span>Main Loop<a class="headerlink" href="#main-loop" title="Permalink to this headline">¬∂</a></h3>
<p>Like the publisher node, the main loop is the loop which will continually run while the node is online. Since all of our actions are occuring within the callback loop we do not have much in our main loop, other than the rospy.spin() function which keeps the kernal alive in the case that it is not actively processing data (but still waiting for messages).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dissect</span><span class="p">(</span><span class="s1">&#39;main_loop&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>class SubscriberNode(object):

    def main_loop(self):
        rospy.spin()
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="final-output">
<h2><span class="section-number">3.5.3. </span>Final Output<a class="headerlink" href="#final-output" title="Permalink to this headline">¬∂</a></h2>
<p>Our resulting output looks like this.</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./src/viper_toolkit"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="sample_publisher.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title"><span class="section-number">3.4. </span>Sample Publisher Nodes</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../../docs/ros_structure.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">3.6. </span>Robot OS (ROS)</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Andrew Damico<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>